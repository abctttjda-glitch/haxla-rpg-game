<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>è–æ¯ã‚ªãƒ¼ãƒˆRPG v1.2.0</title>
<style>
/* ã‚¹ã‚¿ã‚¤ãƒ«ã¯ç¶­æŒã—ã¤ã¤ã€ã‚¢ã‚¤ã‚³ãƒ³ç”¨ã®èª¿æ•´ */
body{ margin:0; background:#111; color:#eee; font-family:sans-serif; font-size:17px; padding:6px; position: relative; }
.version { position: absolute; top: 5px; right: 10px; font-size: 12px; color: #666; }
h2{margin:4px 0;font-size:22px; color:#f1c40f;}
.panel{ background:#1a1a1a; border:1px solid #444; border-radius:6px; padding:8px; margin-bottom:8px; }
button{ width:100%; background:#333; color:#eee; border:1px solid #555; border-radius:6px; font-size:20px; padding:10px 0; margin-top:4px; cursor: pointer; }
.toggleOn{background:#2ecc71;color:#000;font-weight:bold;}
.dead{opacity:0.4; filter: grayscale(100%);}
.partyRow{ font-size:16px; margin:8px 0; border-bottom: 1px solid #333; padding-bottom: 4px; }
.char-icon { font-size: 20px; margin-right: 8px; }
.barWrap{ background:#333; height:10px; border-radius:5px; overflow:hidden; margin-top:4px; }
.bar{background:#e74c3c;height:100%;transition: width 0.2s;}
.log{ font-size:16px; height:180px; overflow-y:auto; background: #000; padding: 5px; display: flex; flex-direction: column-reverse; }
.skill-text { color: #3498db; font-weight: bold; }
.heal-text { color: #2ecc71; }
</style>
</head>
<body>

<div class="version">Version 1.2.0</div>
<h2>è–æ¯ã‚ªãƒ¼ãƒˆRPG</h2>

<div class="panel">
éšå±¤ <span id="floor">1</span>ã€€æ’ƒç ´ <span id="kills">0</span>ã€€è–æ¯Pt <span id="holy">0</span>
</div>

<div class="panel">
<strong>æ•µ: <span id="enemyName"></span></strong>
<div id="enemyText" style="font-size:14px"></div>
<div class="barWrap"><div id="enemyHpBar" class="bar"></div></div>
</div>

<div class="panel">
<strong>ãƒ‘ãƒ¼ãƒ†ã‚£</strong>
<div id="party"></div>
</div>

<div class="panel">
<div style="display:grid; grid-template-columns: 1fr 1fr; gap:4px;">
    <button onclick="upgrade('atk')">ATK+</button>
    <button onclick="upgrade('def')">DEF+</button>
    <button onclick="upgrade('hp')">HP+</button>
    <button onclick="upgrade('exp')">EXP+</button>
</div>
<button id="autoBtn" onclick="toggleAutoUpgrade()">è‡ªå‹•æŒ¯ã‚Š OFF</button>
</div>

<div class="panel log" id="log"></div>

<div class="panel" style="display:flex; gap:10px;">
<button onclick="stepDungeon()" style="flex:1">é€²ã‚€</button>
<button id="mainAutoBtn" onclick="toggleAuto()" style="flex:1">ã‚ªãƒ¼ãƒˆ</button>
</div>

<script>
const SPEED = 8;

const CHAR_DATA=[
 {name:"ãƒ¬ã‚ªãƒ³",job:"ã›ã‚“ã—", icon:"âš”ï¸"},
 {name:"ãƒŸãƒ©",job:"ã¨ã†ãã", icon:"ğŸ—¡ï¸"},
 {name:"ã‚¢ãƒ¼ã‚¯",job:"ã¾ã»ã†ã¤ã‹ã„", icon:"ğŸª„"},
 {name:"ã‚»ãƒ©",job:"ãã†ã‚Šã‚‡", icon:"ğŸ•Šï¸"}
];

const JOBS = {
 "ã›ã‚“ã—": { hp:140, atk:12, def:10, skills: [{ name: "å¼·æ’ƒ", rate: 0.2, effect: (c, e) => { let d = Math.floor(c.atk * 1.8); e.hp -= d; return `${c.icon}${c.name}ã®å¼·æ’ƒï¼ ${d}ãƒ€ãƒ¡`; }}] },
 "ã¨ã†ãã": { hp:100, atk:10, def:5, skills: [{ name: "æ€¥æ‰€çªã", rate: 0.25, effect: (c, e) => { let d = Math.floor(c.atk * 2.2); e.hp -= d; return `${c.icon}${c.name}ã®æ€¥æ‰€çªãï¼ ${d}ãƒ€ãƒ¡`; }}] },
 "ã¾ã»ã†ã¤ã‹ã„": { hp:80, atk:18, def:3, skills: [{ name: "ãƒ•ã‚¡ã‚¤ã‚¢ãƒœãƒ¼ãƒ«", rate: 0.3, effect: (c, e) => { let d = Math.floor(c.atk * 2.5); e.hp -= d; return `${c.icon}${c.name}ã®ç«çƒï¼ ${d}ãƒ€ãƒ¡`; }}] },
 "ãã†ã‚Šã‚‡": { hp:110, atk:8, def:6, skills: [{ name: "ãƒ’ãƒ¼ãƒ«", rate: 0.25, effect: (c, e, p) => { p.forEach(m => { if(m.alive) m.hp = Math.min(m.maxHp, m.hp + 30); }); return `${c.icon}ç¥ˆã‚Šã®å…‰ï¼ å…¨å“¡å›å¾©`; }}] }
};

class Character {
 constructor(d, bonus) {
  const j = JOBS[d.job];
  this.name = d.name; this.job = d.job; this.icon = d.icon;
  this.level = 1; this.exp = 0;
  this.maxHp = j.hp + bonus.hp; this.atk = j.atk + bonus.atk; this.def = j.def + bonus.def;
  this.hp = this.maxHp; this.alive = true;
 }
}

let floor=1, kills=0, holy=0, bonus={atk:0,def:0,hp:0,exp:0}, autoUpgrade=false, party=[], enemy=null, autoIsOn=false;

function addLog(t, colorClass=""){
 const logBox = document.getElementById("log");
 const line = document.createElement("div");
 line.className = colorClass;
 line.innerHTML = t;
 logBox.appendChild(line);
 if(logBox.childNodes.length > 30) logBox.removeChild(logBox.firstChild);
}

function updateUI(){
 document.getElementById("floor").textContent = floor;
 document.getElementById("kills").textContent = kills;
 document.getElementById("holy").textContent = holy;
 const pEl = document.getElementById("party");
 pEl.innerHTML = "";
 party.forEach(c => {
    const row = document.createElement("div");
    row.className = "partyRow " + (c.alive ? "" : "dead");
    const hpPer = (c.hp / c.maxHp) * 100;
    row.innerHTML = `<div><span class="char-icon">${c.icon}</span>${c.name} Lv${c.level} HP:${Math.floor(c.hp)}/${c.maxHp}</div>
                     <div class="barWrap"><div class="bar" style="width:${hpPer}%"></div></div>`;
    pEl.appendChild(row);
 });
}

function updateEnemyUI(){
 if(!enemy) return;
 document.getElementById("enemyName").textContent = enemy.name;
 document.getElementById("enemyText").textContent = `HP: ${Math.floor(enemy.hp)}/${enemy.maxHp}`;
 document.getElementById("enemyHpBar").style.width = (enemy.hp/enemy.maxHp*100) + "%";
}

function battleLoop(){
 if(!enemy) return;
 const it = setInterval(() => {
    party.forEach(c => {
        if(!c.alive || !enemy || enemy.hp <= 0) return;
        if(c.job === "ãã†ã‚Šã‚‡") c.hp = Math.min(c.maxHp, c.hp + 1);
        const jobData = JOBS[c.job];
        let acted = false;
        jobData.skills.forEach(s => {
            if(!acted && Math.random() < s.rate){
                addLog(s.effect(c, enemy, party), "skill-text");
                acted = true;
            }
        });
        if(!acted){
            let dmg = Math.max(1, c.atk - enemy.def);
            enemy.hp -= dmg;
            addLog(`${c.name}ã®æ”»æ’ƒ ${dmg}ãƒ€ãƒ¡`);
        }
    });

    if(enemy && enemy.hp <= 0){
        clearInterval(it);
        addLog(`--- ${enemy.name}ã‚’å€’ã—ãŸï¼ ---`, "heal-text");
        kills++; floor++; 
        if(kills%10===0) holy++;
        party.forEach(c => {
            c.exp += 10;
            if(c.exp >= 20 + c.level*10){ c.level++; c.maxHp+=15; c.hp=c.maxHp; c.atk+=2; }
        });
        enemy = null;
        updateUI();
        if(autoIsOn) setTimeout(stepDungeon, 500 / SPEED); // ã‚ªãƒ¼ãƒˆç¶™ç¶š
        return;
    }

    const target = party.find(c => c.alive);
    if(!target){
        clearInterval(it);
        addLog("å…¨æ»…... è–æ¯ã§å¾©æ´»");
        party.forEach(c => {c.hp=c.maxHp; c.alive=true;});
        enemy = null;
        updateUI();
        if(autoIsOn) setTimeout(stepDungeon, 1000 / SPEED); // å…¨æ»…å¾Œã‚‚ã‚ªãƒ¼ãƒˆç¶™ç¶š
        return;
    }
    
    let eDmg = Math.max(1, enemy.atk - target.def);
    target.hp -= eDmg;
    addLog(`${enemy.name}ã®æ”»æ’ƒï¼ ${target.name}ã«${eDmg}ãƒ€ãƒ¡`);
    if(target.hp <= 0){ target.hp=0; target.alive=false; }
    
    updateUI();
    updateEnemyUI();
 }, 800 / SPEED);
}

function stepDungeon(){ if(!enemy){ 
    const names = ["ğŸ’€ã‚¹ã‚±ãƒ«ãƒˆãƒ³", "ğŸ‘¹ã‚ªãƒ¼ã‚¬", "ğŸãƒ˜ãƒ“", "ğŸ‰ãƒ‰ãƒ©ã‚´ãƒ³"];
    enemy = { name: names[Math.floor(Math.random()*names.length)], maxHp: 50+floor*15, hp: 50+floor*15, atk: 8+floor*2, def: 3+floor };
    updateEnemyUI(); battleLoop(); 
}}

function toggleAuto(){ 
    autoIsOn = !autoIsOn; 
    document.getElementById("mainAutoBtn").className = autoIsOn ? "toggleOn" : "";
    if(autoIsOn) stepDungeon();
}

function upgrade(t){ if(holy<=0)return; holy--; bonus[t]+=(t==="hp"?15:2); updateUI(); }
function toggleAutoUpgrade(){ autoUpgrade=!autoUpgrade; document.getElementById("autoBtn").className=autoUpgrade?"toggleOn":""; }

party = CHAR_DATA.map(d => new Character(d, bonus));
updateUI();
</script>
</body>
</html>
