<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>聖杯オートRPG</title>

<style>
body{
  margin:0;
  background:#111;
  color:#eee;
  font-family:sans-serif;
  font-size:14px;
  padding:6px;
}
h2{font-size:18px;margin:4px 0;}
.panel{
  background:#1a1a1a;
  border:1px solid #444;
  border-radius:6px;
  padding:6px;
  margin-bottom:6px;
}
.buttons{display:flex;gap:4px;}
button{
  flex:1;
  background:#333;
  color:#eee;
  border:1px solid #555;
  border-radius:6px;
  font-size:20px;
  padding:14px 0;
}
button:active{background:#666;transform:scale(0.97);}
.dead{opacity:0.4;}
.barWrap{background:#333;height:10px;border-radius:5px;overflow:hidden;}
.bar{background:#e74c3c;height:100%;}
.partyRow{display:flex;align-items:center;gap:6px;margin:2px 0;}
.icon{width:18px;height:18px;border-radius:4px;}
.enemyIcon{width:36px;height:36px;border-radius:6px;margin-bottom:4px;}
.log{font-size:12px;max-height:70px;overflow:hidden;}
</style>
</head>

<body>

<h2>聖杯オートRPG</h2>

<div class="panel">
距離 <span id="distance">0</span>m /
転生 <span id="rebirth">0</span>
</div>

<div class="panel">
<div id="enemyIcon" class="enemyIcon"></div>
<strong id="enemyName"></strong>
<div id="enemyText"></div>
<div class="barWrap"><div id="enemyHpBar" class="bar"></div></div>
</div>

<div class="panel">
<strong>パーティ</strong>
<div id="party"></div>
</div>

<div class="panel log" id="log"></div>

<div class="panel buttons">
<button onclick="stepDungeon()">進む</button>
<button onclick="toggleAuto()">オート</button>
<button onclick="rebirth()">転生</button>
</div>

<script>
/* ===== キャラ定義 ===== */
const CHAR_DATA=[
 {name:"レオン",sex:"男",job:"せんし",color:"#3498db"},
 {name:"ミラ",sex:"女",job:"とうぞく",color:"#f1c40f"},
 {name:"アーク",sex:"男",job:"まほうつかい",color:"#9b59b6"},
 {name:"セラ",sex:"女",job:"そうりょ",color:"#2ecc71"}
];

/* ===== 職業ステ ===== */
const JOBS={
 せんし:{hp:140,atk:10,def:8},
 とうぞく:{hp:100,atk:9,def:5},
 まほうつかい:{hp:80,atk:14,def:3},
 そうりょ:{hp:90,atk:6,def:4}
};

/* ===== スキル ===== */
const SKILLS={
 せんし:[
  {n:"剛撃",a:c=>c.atk*=1.5},
  {n:"防御態勢",p:c=>c.def+=2},
  {n:"反撃",a:(c,e)=>e.hp-=c.def},
  {n:"闘志",p:c=>c.atk+=2},
  {n:"鉄壁",p:c=>c.maxHp+=20},
  {n:"集中",a:c=>c.atk*=1.2},
  {n:"剣気",p:c=>c.atk+=1},
  {n:"守護",p:c=>c.def+=1},
  {n:"決死",a:c=>c.atk*=2},
  {n:"不屈",p:c=>c.maxHp+=10}
 ],
 とうぞく:[
  {n:"急所",a:(c,e)=>e.hp-=c.atk},
  {n:"回避",p:c=>c.def+=1},
  {n:"連撃",a:(c,e)=>e.hp-=c.atk*0.8},
  {n:"俊敏",p:c=>c.atk+=1},
  {n:"毒刃",a:(c,e)=>e.hp-=3},
  {n:"影",p:c=>c.def+=1},
  {n:"奇襲",a:(c,e)=>e.hp-=c.atk*1.2},
  {n:"盗賊勘",p:c=>c.atk+=1},
  {n:"疾走",p:c=>c.maxHp+=10},
  {n:"弱体",a:(c,e)=>e.def-=1}
 ],
 まほうつかい:[
  {n:"火球",a:(c,e)=>e.hp-=c.atk*1.5},
  {n:"魔力集中",p:c=>c.atk+=2},
  {n:"雷撃",a:(c,e)=>e.hp-=c.atk},
  {n:"知識",p:c=>c.def+=1},
  {n:"氷結",a:(c,e)=>e.def-=1},
  {n:"詠唱",p:c=>c.atk+=1},
  {n:"爆裂",a:(c,e)=>e.hp-=c.atk*2},
  {n:"魔防",p:c=>c.def+=1},
  {n:"精神",p:c=>c.maxHp+=10},
  {n:"魔力放出",a:(c,e)=>e.hp-=c.atk}
 ],
 そうりょ:[
  {n:"回復",a:c=>c.hp=Math.min(c.maxHp,c.hp+20)},
  {n:"祈り",p:c=>c.maxHp+=10},
  {n:"祝福",p:c=>c.atk+=1},
  {n:"加護",p:c=>c.def+=1},
  {n:"癒し",a:c=>c.hp+=10},
  {n:"聖撃",a:(c,e)=>e.hp-=c.atk},
  {n:"再生",p:c=>c.hp+=1},
  {n:"光盾",p:c=>c.def+=1},
  {n:"慈愛",p:c=>c.maxHp+=10},
  {n:"浄化",a:(c,e)=>e.def-=1}
 ]
};

/* ===== 敵 ===== */
const ENEMY_NAMES=["スライム","ゴブリン","オーク","スケルトン"];

class Enemy{
 constructor(dist){
  this.name=ENEMY_NAMES[Math.floor(Math.random()*ENEMY_NAMES.length)];
  this.maxHp=40+dist*0.6;
  this.hp=this.maxHp;
  this.atk=6+dist*0.05;
  this.def=dist*0.02;
 }
}

/* ===== キャラ ===== */
class Character{
 constructor(d){
  this.name=d.name;this.sex=d.sex;this.job=d.job;this.color=d.color;
  const j=JOBS[d.job];
  this.level=1;this.exp=0;
  this.maxHp=j.hp;this.hp=j.hp;
  this.atk=j.atk;this.def=j.def;
  this.alive=true;
  this.skills=SKILLS[d.job];
 }
}

/* ===== 状態 ===== */
let party=[],distance=0,rebirthCount=0;
let currentEnemy=null,autoTimer=null;
const speed=8;

/* ===== ログ ===== */
function logAdd(t){log.innerHTML=t+"<br>"+log.innerHTML;}

/* ===== バトル ===== */
function battle(enemy,end){
 const it=setInterval(()=>{
  for(const c of party){
   if(!c.alive)continue;
   if(Math.random()<0.3){
    const s=c.skills[Math.floor(Math.random()*c.skills.length)];
    s.a && s.a(c,enemy);
    logAdd(`${c.name}の${s.n}`);
   }else{
    enemy.hp-=Math.max(1,c.atk-enemy.def);
   }
   if(enemy.hp<=0)break;
  }
  updateEnemyUI();
  if(enemy.hp<=0){
   clearInterval(it);
   party.forEach(c=>c.exp+=10);
   end();return;
  }
  const t=party.find(c=>c.alive);
  t.hp-=Math.max(1,enemy.atk-t.def);
  if(t.hp<=0)t.alive=false;
  updateUI();
 },600/speed);
}

/* ===== 進行 ===== */
function stepDungeon(){
 distance+=10;
 currentEnemy=new Enemy(distance);
 updateEnemyUI();
 battle(currentEnemy,updateUI);
}

/* ===== UI ===== */
function updateUI(){
 distanceEl.textContent=distance;
 rebirthEl.textContent=rebirthCount;
 partyEl.innerHTML="";
 party.forEach(c=>{
  const r=document.createElement("div");
  r.className="partyRow "+(c.alive?"":"dead");
  const i=document.createElement("div");
  i.className="icon";i.style.background=c.color;
  r.appendChild(i);
  r.appendChild(document.createTextNode(
   `${c.name}(${c.job}) Lv${c.level} HP${c.hp}/${c.maxHp}`
  ));
  partyEl.appendChild(r);
 });
}
function updateEnemyUI(){
 if(!currentEnemy)return;
 enemyName.textContent=currentEnemy.name;
 enemyText.textContent=`HP ${currentEnemy.hp}/${currentEnemy.maxHp}`;
 enemyHpBar.style.width=(currentEnemy.hp/currentEnemy.maxHp*100)+"%";
}

/* ===== 操作 ===== */
function toggleAuto(){
 autoTimer?
 (clearInterval(autoTimer),autoTimer=null):
 (autoTimer=setInterval(stepDungeon,2000/speed));
}
function rebirth(){
 if(distance<100)return logAdd("100m未満では転生不可");
 rebirthCount++;distance=0;
 party.forEach(c=>{
  c.maxHp+=20;c.atk+=5;c.def+=3;
  c.hp=c.maxHp;c.alive=true;
 });
 logAdd("転生した");
 updateUI();
}

/* ===== 起動 ===== */
party=CHAR_DATA.map(d=>new Character(d));
updateUI();
</script>

</body>
</html>