<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>è–æ¯RPGï¼šå­¤é«˜ã®å‹‡è€… v3.5.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<style>
:root { --main-bg: #0d0d0d; --panel-bg: #1a1a1a; --accent: #f1c40f; --text: #eee; --border: #333; --danger: #e74c3c; }
* { touch-action: manipulation; box-sizing: border-box; -webkit-user-select: none; }
body { margin:0; background:var(--main-bg); color:var(--text); font-family:monospace; font-size:14px; height: 100dvh; display:flex; flex-direction:column; padding:8px; overflow:hidden; }
button { background:#333; color:#eee; border:1px solid #555; border-radius:4px; cursor:pointer; padding:8px; font-weight:bold; }
button:active { background: #555; }
.toggleOn { background:#27ae60 !important; border-color:#2ecc71 !important; }

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
.header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }

/* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºï¼ˆã“ã“ã‚’å¤§ããæ”¹å–„ï¼‰ */
.hero-panel { flex: 1; background:var(--panel-bg); border:2px solid var(--border); border-radius:12px; padding:15px; display:flex; flex-direction:column; align-items:center; gap:10px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
.hero-icon { font-size: 48px; margin-bottom: 5px; }
.hero-name { font-size: 20px; font-weight: bold; color: var(--accent); }
.hero-stats { width: 100%; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
.stat-box { background: rgba(0,0,0,0.3); padding: 8px; border-radius: 6px; text-align: center; border: 1px solid #444; }
.stat-val { font-size: 18px; color: #fff; display: block; }
.hp-container { width: 100%; margin-top: 5px; }
.hp-bar { background:#222; height:14px; border-radius:7px; overflow:hidden; border:1px solid #555; position:relative; }
.hp-fill { background:linear-gradient(90deg, #e74c3c, #ff7675); height:100%; width:100%; transition: width 0.2s; }

/* æ•µãƒ»é€²è¡Œ */
.battle-info { background:#222; border-left: 4px solid var(--danger); padding:8px; border-radius:4px; margin-bottom:8px; display:flex; justify-content:space-between; align-items:center; }

/* ãƒ­ã‚° */
.log-area { height: 70px; background:#000; border:1px solid var(--border); border-radius:6px; margin: 8px 0; padding:5px; overflow-y:auto; font-size:11px; color:#aaa; display:flex; flex-direction:column-reverse; }

/* ãƒ•ãƒƒã‚¿ãƒ¼ */
.footer { display: grid; grid-template-columns: 1fr 2fr; gap: 8px; height: 50px; }

/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
.modal { display: none; position: fixed; inset:0; background:rgba(0,0,0,0.9); z-index:100; justify-content:center; align-items:center; }
.modal-content { background:#222; border:1px solid #444; border-radius:12px; width:90%; max-width:320px; padding:20px; }
</style>
</head>
<body>

<div class="header">
    <div><small>è–æ¯Pt:</small> <strong id="holy" style="color:var(--accent); font-size:18px;">0</strong></div>
    <div style="display:flex; gap:6px;">
        <button onclick="openModal('upgradeModal')">âœ¨å¼·åŒ–</button>
        <button onclick="openModal('gachaModal')">ğŸã‚¬ãƒãƒ£</button>
    </div>
</div>

<div class="battle-info">
    <div><span id="targetName" style="color:var(--danger); font-weight:bold;">å¾…æ©Ÿä¸­</span></div>
    <div style="font-size:12px;">Progress: <span id="battleStep">0/10</span></div>
</div>

<div class="hero-panel">
    <div class="hero-icon">ğŸ›¡ï¸</div>
    <div class="hero-name">å­¤é«˜ã®å‹‡è€… <small id="heroLv" style="font-size:12px; color:#aaa;">Lv.1</small></div>
    
    <div class="hp-container">
        <div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:2px;">
            <span>HP</span><span id="hpText">100/100</span>
        </div>
        <div class="hp-bar"><div id="hpFill" class="hp-fill"></div></div>
    </div>

    <div class="hero-stats">
        <div class="stat-box"><small>æ”»æ’ƒåŠ›</small><span id="atkVal" class="stat-val">10</span></div>
        <div class="stat-box"><small>é˜²å¾¡åŠ›</small><span id="defVal" class="stat-val">5</span></div>
        <div class="stat-box" style="grid-column: span 2;">
            <small>ç¾åœ¨ã®è£…å‚™</small>
            <div id="equipText" style="font-size:11px; color:#aaa; margin-top:4px;">æœ¨ã®æ£’ / å¸ƒã®æœ</div>
        </div>
    </div>
</div>

<div class="log-area" id="log"></div>

<div class="footer">
    <button onclick="openModal('dungeonModal')" style="background:#2980b9;">ğŸ° æ½œã‚‹</button>
    <button id="autoBtn" onclick="toggleAuto()">ã‚ªãƒ¼ãƒˆé–‹å§‹</button>
</div>

<div id="dungeonModal" class="modal">
    <div class="modal-content">
        <h3 style="margin:0 0 15px 0; text-align:center;">ğŸ° ç›®çš„åœ°ã‚’é¸æŠ</h3>
        <div style="display:grid; gap:10px;">
            <button onclick="startDungeon(0)" style="text-align:left;">ğŸŸ¢ åˆç´šï¼šé™ã‹ãªæ£® (Lv1~)</button>
            <button onclick="startDungeon(1)" style="text-align:left;">ğŸŸ¡ ä¸­ç´šï¼šè’ã‚ŒãŸå»ƒéƒ½ (Lv15~)</button>
            <button onclick="startDungeon(2)" style="text-align:left;">ğŸ”´ è¶…ç´šï¼šç«œã®å·£ (Lv40~)</button>
        </div>
        <button onclick="closeModal('dungeonModal')" style="width:100%; margin-top:15px; background:#444;">é–‰ã˜ã‚‹</button>
    </div>
</div>

<div id="upgradeModal" class="modal">
    <div class="modal-content">
        <h3 style="margin:0 0 15px 0; text-align:center;">âœ¨ è–æ¯ã®åŠ è­·</h3>
        <div id="upRows"></div>
        <button onclick="closeModal('upgradeModal')" style="width:100%; margin-top:15px;">é–‰ã˜ã‚‹</button>
    </div>
</div>

<div id="gachaModal" class="modal">
    <div class="modal-content" style="text-align:center;">
        <h3 style="margin:0;">ğŸ è–æ¯ã‚¬ãƒãƒ£</h3>
        <div id="gachaResult" style="height:100px; display:flex; align-items:center; justify-content:center; font-size:20px; color:var(--accent);">Ptã‚’ä½¿ã£ã¦å¼·åŒ–ï¼</div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <button onclick="playGacha(1)">1å› (1Pt)</button>
            <button onclick="playGacha(10)" style="background:#8e44ad;">10å› (10Pt)</button>
        </div>
        <button onclick="closeModal('gachaModal')" style="width:100%; margin-top:15px; background:#444;">é–‰ã˜ã‚‹</button>
    </div>
</div>

<script>
const SAVE_KEY = "HolyRPG_Solo_v3.5";
let holy=0, autoIsOn=false, currentDungeon=null, dungeonIdx=0, step=0, inBattle=false;
let bonus={atk:0, def:0, hp:0};
let hero = { lv:1, exp:0, hp:100, maxHp:100, atk:10, def:5, wName:"æœ¨ã®æ", wVal:0, aName:"å¸ƒã®æœ", aVal:0 };

const DUNGEONS = [
    { name:"é™ã‹ãªæ£®", pow:1, boss:"å¤§æ£®ã®ç‹" },
    { name:"è’ã‚ŒãŸå»ƒéƒ½", pow:5, boss:"äº¡å›½ã®é¨å£«" },
    { name:"ç«œã®å·£", pow:15, boss:"å¤ã®ç„”ç«œ" }
];

function updateStats() {
    const g = 1 + (hero.lv - 1) * 0.04;
    hero.maxHp = Math.floor((200 + bonus.hp + (hero.lv-1)*25) * g);
    hero.atk = Math.floor((15 + bonus.atk + (hero.lv-1)*4 + hero.wVal) * g);
    hero.def = Math.floor((10 + bonus.def + (hero.lv-1)*3 + hero.aVal) * g);
    if(hero.hp > hero.maxHp || hero.hp <= 0 && !inBattle) hero.hp = hero.maxHp;
    
    document.getElementById("holy").innerText = holy;
    document.getElementById("heroLv").innerText = `Lv.${hero.lv}`;
    document.getElementById("atkVal").innerText = hero.atk;
    document.getElementById("defVal").innerText = hero.def;
    document.getElementById("hpText").innerText = `${Math.floor(hero.hp)}/${hero.maxHp}`;
    document.getElementById("hpFill").style.width = (hero.hp/hero.maxHp*100) + "%";
    document.getElementById("equipText").innerText = `âš”ï¸${hero.wName}+${hero.wVal} / ğŸ›¡ï¸${hero.aName}+${hero.aVal}`;
    
    const ur = document.getElementById("upRows"); ur.innerHTML = "";
    [{k:'atk',n:'æ”»æ’ƒåŠ›'},{k:'def',n:'é˜²å¾¡åŠ›'},{k:'hp',n:'æœ€å¤§HP'}].forEach(s => {
        const r = document.createElement("div"); r.style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; background:#111; padding:8px; border-radius:6px;";
        r.innerHTML = `<span>${s.n}: ${bonus[s.k]}</span><div><button onclick="modBonus('${s.k}',-1)">-</button> <button onclick="modBonus('${s.k}',1)">+</button></div>`;
        ur.appendChild(r);
    });
}

function startDungeon(idx) {
    dungeonIdx = idx;
    currentDungeon = DUNGEONS[idx];
    step = 0; inBattle = false;
    closeModal('dungeonModal');
    addLog(`ğŸ° ãƒ€ãƒ³ã‚¸ãƒ§ãƒ³ã€Œ${currentDungeon.name}ã€ã‚’é–‹å§‹`);
    nextBattle();
}

function nextBattle() {
    if(!currentDungeon) return;
    step++;
    if(step > 10) {
        addLog(`ğŸ‰ ã‚¯ãƒªã‚¢ï¼è–æ¯Pt+3`, "#2ecc71");
        holy += 3; currentDungeon = null; save(); updateStats();
        if(autoIsOn) setTimeout(() => startDungeon(dungeonIdx), 2000);
        return;
    }
    document.getElementById("battleStep").innerText = `${step}/10`;
    const isBoss = (step === 10);
    const p = currentDungeon.pow * (isBoss ? 2.5 : 1);
    const enemy = { name: isBoss ? `[BOSS]${currentDungeon.boss}` : "é­”ç‰©", hp: (100 + step*60)*p, atk: (8 + step*5)*p, def: (5 + step*3)*p };
    document.getElementById("targetName").innerText = enemy.name;
    runBattle(enemy, isBoss);
}

function runBattle(e, isBoss) {
    inBattle = true;
    const it = setInterval(() => {
        // å‹‡è€…ã®æ”»æ’ƒ
        let d = Math.max(1, hero.atk - e.def);
        if(Math.random() < 0.1) { d *= 2; addLog(`ğŸ’¥ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ï¼`, "#f1c40f"); }
        e.hp -= d;

        if(e.hp <= 0) {
            clearInterval(it);
            addLog(`${e.name}ã‚’å€’ã—ãŸ`);
            if(isBoss) dropItem();
            hero.exp += 50; if(hero.exp>=100){ hero.lv++; hero.exp=0; addLog(`ğŸ†™ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼`, "#f1c40f"); }
            inBattle = false; save(); updateStats();
            if(autoIsOn) setTimeout(nextBattle, 1000);
        } else {
            // æ•µã®æ”»æ’ƒ
            hero.hp -= Math.max(1, e.atk - hero.def);
            updateStats();
            if(hero.hp <= 0) {
                clearInterval(it);
                hero.hp = 0; addLog("ğŸ’€å…¨æ»…... ã‚­ãƒ£ãƒ³ãƒ—ã¸æˆ»ã‚Šã¾ã™", "#e74c3c");
                inBattle = false; updateStats();
                // ã‚ªãƒ¼ãƒˆãªã‚‰5ç§’å¾Œã«å†é–‹
                if(autoIsOn) {
                    addLog("â³å†æŒ‘æˆ¦ã®æº–å‚™ä¸­...", "#888");
                    setTimeout(() => { hero.hp = hero.maxHp; startDungeon(dungeonIdx); }, 5000);
                } else {
                    currentDungeon = null;
                }
            }
        }
    }, 200);
}

function dropItem() {
    const prefixes = ["ä¼èª¬ã®", "å¤ã®", "è–ãªã‚‹", "å‘ªã‚ã‚ŒãŸ", "ç¥ã®"];
    if(Math.random() > 0.5) {
        hero.wName = prefixes[Math.floor(Math.random()*5)] + "å‰£";
        hero.wVal += (currentDungeon.pow * 4);
        addLog(`ğŸ ãƒ¦ãƒ‹ãƒ¼ã‚¯æ­¦å™¨ã€Œ${hero.wName}ã€ã‚’ç²å¾—ï¼`, "#f1c40f");
    } else {
        hero.aName = prefixes[Math.floor(Math.random()*5)] + "é§";
        hero.aVal += (currentDungeon.pow * 4);
        addLog(`ğŸ ãƒ¦ãƒ‹ãƒ¼ã‚¯é˜²å…·ã€Œ${hero.aName}ã€ã‚’ç²å¾—ï¼`, "#f1c40f");
    }
}

function playGacha(t) {
    if(holy < t) return; holy -= t;
    let res = "";
    for(let i=0; i<t; i++) {
        if(Math.random()>0.5) { hero.wVal += 2; res = "âš”ï¸æ­¦å™¨å¼·åŒ–(+2)"; }
        else { hero.aVal += 2; res = "ğŸ›¡ï¸é˜²å…·å¼·åŒ–(+2)"; }
    }
    document.getElementById("gachaResult").innerText = t > 1 ? `10é€£ï¼šè£…å‚™ãŒå¤§å¹…ã«å¼·åŒ–ï¼` : res;
    updateStats(); save();
}

function modBonus(k, v) {
    if(v > 0) { if(holy>=1){ bonus[k]+=1; holy-=1; } }
    else { if(bonus[k]>0){ bonus[k]-=1; holy+=1; } }
    updateStats(); save();
}

function toggleAuto() { autoIsOn = !autoIsOn; document.getElementById("autoBtn").classList.toggle("toggleOn", autoIsOn); if(autoIsOn && !inBattle && !currentDungeon) startDungeon(dungeonIdx); }
function openModal(id) { document.getElementById(id).style.display = "flex"; }
function closeModal(id) { document.getElementById(id).style.display = "none"; }
function addLog(m, col="#aaa") {
    const l = document.getElementById("log"); const d = document.createElement("div");
    d.style.color = col; d.innerText = m; l.prepend(d);
    if(l.childNodes.length > 20) l.removeChild(l.lastChild);
}

function save() {
    const d = { holy, bonus, hero: {lv:hero.lv, wN:hero.wName, wV:hero.wVal, aN:hero.aName, aV:hero.aVal}, dungeonIdx};
    localStorage.setItem(SAVE_KEY, JSON.stringify(d));
}
function load() {
    const s = localStorage.getItem(SAVE_KEY);
    if(s) {
        const d = JSON.parse(s); holy=d.holy; bonus=d.bonus; dungeonIdx=d.dungeonIdx||0;
        hero.lv=d.hero.lv; hero.wName=d.hero.wN; hero.wVal=d.hero.wV; hero.aName=d.hero.aN; hero.aVal=d.hero.aV;
    }
}
load(); updateStats();
</script>
</body>
</html>
