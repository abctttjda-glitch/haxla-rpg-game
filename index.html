<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Monster Slayer v3.6.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<style>
:root { --bg: #0a0a0a; --panel: #161616; --accent: #f1c40f; --danger: #e74c3c; --text: #eee; }
* { touch-action: manipulation; box-sizing: border-box; -webkit-user-select: none; }
body { margin:0; background:var(--bg); color:var(--text); font-family: 'Hiragino Kaku Gothic ProN', sans-serif; height: 100dvh; display:flex; flex-direction:column; padding:10px; overflow:hidden; }
button { background:#333; color:#eee; border:1px solid #555; border-radius:6px; cursor:pointer; font-weight:bold; }
.toggleOn { background:#27ae60 !important; border-color:#2ecc71 !important; }

/* ã‚®ãƒ«ãƒ‰è³‡ç”£çŠ¶æ³ */
.guild-status { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px; }
.status-card { background:var(--panel); border-radius:8px; padding:8px; border:1px solid #333; text-align:center; }
.status-card small { font-size:10px; color:#aaa; display:block; }
.status-card span { font-size:16px; color:var(--accent); font-weight:bold; }

/* ãƒãƒˆãƒ«ã‚¨ãƒªã‚¢ï¼ˆæ•µã‚’æœ€å¤§åŒ–ï¼‰ */
.battle-core { flex: 1; background:var(--panel); border:2px solid #444; border-radius:12px; display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative; overflow:hidden; margin-bottom:10px; }
.enemy-emoji { font-size: 100px; margin: 10px 0; text-shadow: 0 0 20px rgba(231, 76, 60, 0.4); transition: transform 0.1s; }
.enemy-name { font-size: 22px; font-weight: bold; color: var(--danger); margin-bottom: 5px; }
.enemy-hp-container { width: 80%; }
.hp-bar { background:#222; height:18px; border-radius:9px; overflow:hidden; border:1px solid #555; position:relative; }
.hp-fill { background:linear-gradient(90deg, #c0392b, #e74c3c); height:100%; width:100%; transition: width 0.1s; }
.progress-dots { position:absolute; top:10px; right:10px; font-size:12px; color:#888; }

/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ï¼ˆä¸‹éƒ¨ã«é…ç½®ï¼‰ */
.player-info { background:var(--panel); border:1px solid #333; border-radius:10px; padding:10px; display:grid; grid-template-columns: 1fr 2fr; gap:10px; align-items:center; }
.hero-stats { font-size: 13px; line-height: 1.5; }
.hp-val { color: #2ecc71; font-weight:bold; }

/* ãƒ­ã‚° */
.log-area { height: 60px; background:#000; font-size:11px; color:#888; padding:5px; margin:8px 0; border-radius:5px; overflow-y:auto; display:flex; flex-direction:column-reverse; }

.footer { display: grid; grid-template-columns: 1fr 1fr 1.5fr; gap: 6px; height: 50px; }

/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
.modal { display: none; position: fixed; inset:0; background:rgba(0,0,0,0.9); z-index:100; justify-content:center; align-items:center; }
.modal-content { background:#222; border-radius:12px; width:90%; max-width:320px; padding:20px; border:1px solid #444; }
</style>
</head>
<body>

<div class="guild-status">
    <div class="status-card"><small>ã‚®ãƒ«ãƒ‰è–æ¯Pt (å¼·åŒ–ç”¨)</small><span id="holy">0</span></div>
    <div class="status-card"><small>ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼è¨ä¼Pt (ã‚¬ãƒãƒ£ç”¨)</small><span id="slayPt">0</span></div>
</div>

<div class="battle-core">
    <div class="progress-dots" id="battleStep">ä¾é ¼é€²è¡Œåº¦: 0/10</div>
    <div class="enemy-name" id="enemyName">---</div>
    <div class="enemy-emoji" id="enemyEmoji">â”</div>
    <div class="enemy-hp-container">
        <div class="hp-bar"><div id="enemyHpFill" class="hp-fill"></div></div>
    </div>
</div>

<div class="player-info">
    <div style="font-size:30px; text-align:center;">ğŸ›¡ï¸</div>
    <div class="hero-stats">
        <strong>å‹‡è€… Lv.<span id="heroLv">1</span></strong><br>
        HP: <span id="heroHp" class="hp-val">0/0</span><br>
        ATK: <span id="atkVal">0</span> / DEF: <span id="defVal">0</span>
    </div>
</div>

<div class="log-area" id="log"></div>

<div class="footer">
    <button onclick="openModal('upgradeModal')">âœ¨å¼·åŒ–</button>
    <button onclick="openModal('gachaModal')">ğŸã‚¬ãƒãƒ£</button>
    <button id="autoBtn" onclick="toggleAuto()" class="toggleOn">ã‚ªãƒ¼ãƒˆON</button>
</div>

<div id="upgradeModal" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0;">âœ¨ è–æ¯ã®åŠ è­· (å¼·åŒ–)</h3>
        <p style="font-size:12px; color:#aaa;">è–æ¯Ptã‚’æ¶ˆè²»ã—ã¦åŸºç¤èƒ½åŠ›ã‚’ä¸Šã’ã¾ã™</p>
        <div id="upRows"></div>
        <button onclick="closeModal('upgradeModal')" style="width:100%; margin-top:10px;">é–‰ã˜ã‚‹</button>
    </div>
</div>

<div id="gachaModal" class="modal">
    <div class="modal-content" style="text-align:center;">
        <h3 style="margin:0;">ğŸ è¨ä¼å ±é…¬ã‚¬ãƒãƒ£</h3>
        <div id="gachaResult" style="height:100px; display:flex; align-items:center; justify-content:center; font-size:20px; color:var(--accent);">è¨ä¼Ptã‚’è£…å‚™ã«å¤‰æ›ï¼</div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <button onclick="playGacha(1)">1å› (10pt)</button>
            <button onclick="playGacha(10)" style="background:#8e44ad;">10å› (100pt)</button>
        </div>
        <button onclick="closeModal('gachaModal')" style="width:100%; margin-top:15px;">é–‰ã˜ã‚‹</button>
    </div>
</div>

<script>
const SAVE_KEY = "MonsterSlayer_v3.6";
let holy=0, slayPt=0, autoIsOn=true, step=0, inBattle=false;
let bonus={atk:0, def:0, hp:0};
let hero = { lv:1, exp:0, hp:100, maxHp:100, atk:10, def:5, wVal:0, aVal:0 };

const MONSTERS = [
    { n: "ã‚´ãƒ–ãƒªãƒ³", e: "ğŸ‘º", hp: 1.0, atk: 1.0 },
    { n: "ã‚ªãƒ¼ã‚¯", e: "ğŸ—", hp: 2.5, atk: 1.8 },
    { n: "ã‚­ãƒ¡ãƒ©", e: "ğŸ¦", hp: 5.0, atk: 3.0 },
    { n: "ãƒ‰ãƒ©ã‚´ãƒ³", e: "ğŸ‰", hp: 12.0, atk: 6.0 },
    { n: "é­”ç‹ã®å½±", e: "ğŸ’€", hp: 25.0, atk: 10.0 }
];

function updateUI() {
    const g = 1 + (hero.lv - 1) * 0.04;
    hero.maxHp = Math.floor((200 + bonus.hp + (hero.lv-1)*25) * g);
    hero.atk = Math.floor((15 + bonus.atk + (hero.lv-1)*4 + hero.wVal) * g);
    hero.def = Math.floor((10 + bonus.def + (hero.lv-1)*3 + hero.aVal) * g);
    
    document.getElementById("holy").innerText = holy;
    document.getElementById("slayPt").innerText = slayPt;
    document.getElementById("heroLv").innerText = hero.lv;
    document.getElementById("heroHp").innerText = `${Math.floor(hero.hp)}/${hero.maxHp}`;
    document.getElementById("atkVal").innerText = hero.atk;
    document.getElementById("defVal").innerText = hero.def;

    const ur = document.getElementById("upRows"); ur.innerHTML = "";
    [{k:'atk',n:'æ”»æ’ƒåŠ›'},{k:'def',n:'é˜²å¾¡åŠ›'},{k:'hp',n:'æœ€å¤§HP'}].forEach(s => {
        const r = document.createElement("div"); r.style="display:flex; justify-content:space-between; margin-bottom:10px;";
        r.innerHTML = `<span>${s.n}: ${bonus[s.k]}</span><div><button onclick="modBonus('${s.k}',1)">å¼·åŒ–</button></div>`;
        ur.appendChild(r);
    });
}

function nextBattle() {
    if(!autoIsOn || inBattle) return;
    step++;
    if(step > 10) {
        addLog("ğŸ‘‘ ä¾é ¼é”æˆï¼ãƒœãƒ¼ãƒŠã‚¹è–æ¯Ptç²å¾—", "#f1c40f");
        holy += 1; step = 0; save(); 
    }
    document.getElementById("battleStep").innerText = `ä¾é ¼é€²è¡Œåº¦: ${step}/10`;
    
    // æ•µã®é¸å®š
    const mBase = MONSTERS[Math.min(MONSTERS.length-1, Math.floor(hero.lv / 10))];
    const rank = (step === 10) ? 2.5 : 1.0;
    const enemy = {
        name: (step === 10) ? `[BOSS] ${mBase.n}` : mBase.n,
        emoji: mBase.e,
        hp: (100 + hero.lv * 40) * mBase.hp * rank,
        atk: (5 + hero.lv * 4) * mBase.atk * rank,
        maxHp: 0
    };
    enemy.maxHp = enemy.hp;
    
    document.getElementById("enemyName").innerText = enemy.name;
    document.getElementById("enemyEmoji").innerText = enemy.emoji;
    startFight(enemy);
}

function startFight(e) {
    inBattle = true;
    const it = setInterval(() => {
        // å‹‡è€…ã®æ”»æ’ƒ
        let d = Math.max(1, hero.atk - (e.atk * 0.2));
        e.hp -= d;
        document.getElementById("enemyEmoji").style.transform = "scale(0.9)";
        setTimeout(() => document.getElementById("enemyEmoji").style.transform = "scale(1)", 50);

        if(e.hp <= 0) {
            clearInterval(it);
            document.getElementById("enemyHpFill").style.width = "0%";
            addLog(`${e.name}ã‚’è¨ä¼ï¼è¨ä¼Pt+10`);
            slayPt += 10; hero.exp += 34;
            if(hero.exp >= 100) { hero.lv++; hero.exp=0; addLog("ğŸ†™ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼"); }
            inBattle = false; save(); updateUI();
            setTimeout(nextBattle, 100); // ã‚¯ãƒªã‚¢å¾Œå³æ¬¡æˆ¦
        } else {
            // æ•µã®æ”»æ’ƒ
            hero.hp -= Math.max(1, e.atk - hero.def);
            document.getElementById("enemyHpFill").style.width = (e.hp/e.maxHp*100) + "%";
            updateUI();

            if(hero.hp <= 0) {
                clearInterval(it);
                hero.hp = 0; addLog("ğŸ’€æ•—åŒ—... å³åº§ã«æˆ¦ç·šå¾©å¸°ã—ã¾ã™", "#e74c3c");
                inBattle = false; updateUI();
                setTimeout(() => { hero.hp = hero.maxHp; nextBattle(); }, 100); // å…¨æ»…å¾Œå³å†æˆ¦
            }
        }
    }, 150);
}

function playGacha(t) {
    const cost = t * 10;
    if(slayPt < cost) return;
    slayPt -= cost;
    let res = "";
    for(let i=0; i<t; i++) {
        if(Math.random()>0.5) { hero.wVal += 2; res = "âš”ï¸æ­¦å™¨å¼·åŒ–(+2)"; }
        else { hero.aVal += 2; res = "ğŸ›¡ï¸é˜²å…·å¼·åŒ–(+2)"; }
    }
    document.getElementById("gachaResult").innerText = t > 1 ? `10é€£å ±é…¬ç²å¾—ï¼` : res;
    updateUI(); save();
}

function modBonus(k, v) {
    if(holy >= 1) { bonus[k] += 1; holy -= 1; }
    updateUI(); save();
}

function toggleAuto() { 
    autoIsOn = !autoIsOn; 
    document.getElementById("autoBtn").innerText = autoIsOn ? "ã‚ªãƒ¼ãƒˆON" : "ã‚ªãƒ¼ãƒˆOFF";
    document.getElementById("autoBtn").className = autoIsOn ? "toggleOn" : "";
    if(autoIsOn) nextBattle(); 
}
function openModal(id) { document.getElementById(id).style.display = "flex"; }
function closeModal(id) { document.getElementById(id).style.display = "none"; }
function addLog(m, col="#888") {
    const l = document.getElementById("log"); const d = document.createElement("div");
    d.style.color = col; d.innerText = m; l.prepend(d);
    if(l.childNodes.length > 10) l.removeChild(l.lastChild);
}

function save() {
    const d = { holy, slayPt, bonus, hero: {lv:hero.lv, wV:hero.wVal, aV:hero.aVal}, autoIsOn};
    localStorage.setItem(SAVE_KEY, JSON.stringify(d));
}
function load() {
    const s = localStorage.getItem(SAVE_KEY);
    if(s) {
        const d = JSON.parse(s); holy=d.holy; slayPt=d.slayPt; bonus=d.bonus;
        hero.lv=d.hero.lv; hero.wVal=d.hero.wV; hero.aVal=d.hero.aV;
    }
    hero.hp = hero.maxHp;
}
load(); updateUI(); nextBattle();
</script>
</body>
</html>
